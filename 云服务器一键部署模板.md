# Python Web 项目云服务器部署模板

---

## ⚠️ 文件定位声明（给 AI 的说明）

**这是什么：**
这是一份【参数化部署模板】，用于在云服务器上部署 Python Web 项目。

**AI 你需要做什么：**
1. 读取下方的【项目信息】和【服务器信息】
2. 将这些信息填入模板中的占位符 `【xxx】`
3. 生成完整的 deploy 文件夹，包含所有配置文件

**AI 你不能做什么：**
- 不能省略任何文件
- 不能只给示例或片段
- 不能自由发挥新增配置
- 不能保留任何 `【xxx】` 占位符
- 不能输出解释性文字，直接生成文件

**最终输出：**
你必须生成以下 6 个文件，缺一不可：
```
deploy/
├── Dockerfile
├── docker-compose.yml
├── deploy.sh
├── nginx.conf
├── 【项目名称】.service
└── README.md
```

---

## 📁 项目信息（每个项目不同）

> **AI 注意：**
> 1. 这份模板文件位于项目根目录，你已经可以访问整个项目的代码和文件
> 2. 请先分析项目结构（README.md、requirements.txt、入口文件等），自动识别以下参数
> 3. 将识别到的参数填入下表，替换 `待填写` 的内容
> 4. 如果某个参数无法自动识别，请询问用户

| 参数 | 值 | 说明 |
|------|-----|------|
| 项目名称 | `待填写` | 英文小写，用于容器名、镜像名（如 `pixel-art`） |
| 项目描述 | `待填写` | 中文描述，用于注释（如 `像素画生成器`） |
| GitHub 地址 | `待填写` | 项目仓库地址（从 .git 配置或询问用户） |
| 项目文件夹名 | `待填写` | clone 后的文件夹名（通常是仓库名） |
| 入口文件 | `待填写` | 启动应用的文件（如 `app.py`、`main.py`） |
| Python 版本 | `待填写` | 项目使用的版本（如 `3.11`） |
| 端口号 | `待填写` | 应用运行端口（从代码中识别，如 Gradio 默认 7860） |

---

## 🖥️ 服务器信息（基本固定）

> **AI 注意：** 这部分参数通常不变，除非用户更换服务器。如果下方已有值则直接使用，如果是 `待填写` 则询问用户。

| 参数 | 值 |
|------|-----|
| 服务器 IP | `59.110.55.185` |
| SSH 用户名 | `root` |
| 项目部署路径 | `待填写` | 

> 项目部署路径格式：`~/workspace/【项目文件夹名】`

---

## 📋 占位符对照表

> **AI 注意：** 生成文件时，将模板中的占位符替换为上方表格中的实际值。此表格在你填充完项目信息后自动对应。

| 占位符 | 对应参数 |
|--------|----------|
| `【项目名称】` | 项目信息 → 项目名称 |
| `【项目描述】` | 项目信息 → 项目描述 |
| `【GitHub地址】` | 项目信息 → GitHub 地址 |
| `【项目文件夹名】` | 项目信息 → 项目文件夹名 |
| `【入口文件】` | 项目信息 → 入口文件 |
| `【Python版本】` | 项目信息 → Python 版本 |
| `【端口号】` | 项目信息 → 端口号 |
| `【服务器IP】` | 服务器信息 → 服务器 IP |
| `【SSH用户名】` | 服务器信息 → SSH 用户名 |
| `【项目路径】` | 服务器信息 → 项目部署路径 |

---

# 配置文件模板

以下是每个文件的模板内容，AI 生成时将占位符替换为实际值即可。

---

## 1. Dockerfile

```dockerfile
FROM python:【Python版本】-slim

WORKDIR /app

# 安装依赖（使用阿里云镜像加速）
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com

# 复制项目文件
COPY . .

# 应用端口
EXPOSE 【端口号】

# 启动命令
CMD ["python", "【入口文件】"]
```

---

## 2. docker-compose.yml

> AI 注意：此文件放在 deploy 文件夹内，build 路径 `..` 指向项目根目录。

```yaml
version: '3.8'

services:
  【项目名称】:
    build: ..
    ports:
      - "【端口号】:【端口号】"
    restart: unless-stopped
    volumes:
      - ../data:/app/data
    environment:
      - GRADIO_SERVER_NAME=0.0.0.0
```

---

## 3. deploy.sh

```bash
#!/bin/bash
# 【项目描述】 - 服务器部署脚本

set -e

echo "=== 【项目描述】部署脚本 ==="

# 1. 更新系统并安装依赖
echo "[1/4] 安装系统依赖..."
sudo apt update
sudo apt install -y python3 python3-pip python3-venv

# 2. 创建虚拟环境
echo "[2/4] 创建 Python 虚拟环境..."
python3 -m venv venv
source venv/bin/activate

# 3. 安装 Python 依赖
echo "[3/4] 安装 Python 依赖..."
pip install --upgrade pip
pip install -r requirements.txt -i https://mirrors.aliyun.com/pypi/simple/

# 4. 启动服务
echo "[4/4] 启动服务..."
echo "应用将在 http://0.0.0.0:【端口号】 运行"
python 【入口文件】
```

---

## 4. nginx.conf

```nginx
server {
    listen 80;
    server_name 【服务器IP】;

    location / {
        proxy_pass http://127.0.0.1:【端口号】;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_read_timeout 86400;
    }

    client_max_body_size 50M;
}
```

---

## 5. 【项目名称】.service

> AI 注意：文件名使用实际项目名称，如 `pixel-art.service`

```ini
[Unit]
Description=【项目描述】
After=network.target

[Service]
Type=simple
User=root
WorkingDirectory=【项目路径】
ExecStart=【项目路径】/venv/bin/python 【项目路径】/【入口文件】
Restart=always
RestartSec=10
Environment=GRADIO_SERVER_NAME=0.0.0.0

[Install]
WantedBy=multi-user.target
```

---

## 6. README.md

> AI 注意：这是部署说明文档，包含具体的操作命令。

```markdown
# 【项目描述】 - 部署指南

服务器：`【服务器IP】`
访问地址：`http://【服务器IP】:【端口号】`

---

## 连接服务器

```bash
ssh 【SSH用户名】@【服务器IP】
```

---

## Docker 部署（推荐）

### 首次部署

```bash
cd ~/workspace
git clone 【GitHub地址】
cd 【项目文件夹名】
docker build -t 【项目名称】 -f deploy/Dockerfile .
docker run -d -p 【端口号】:【端口号】 --name 【项目名称】 --restart unless-stopped 【项目名称】
```

### 更新代码

```bash
cd 【项目路径】
git pull
docker stop 【项目名称】
docker rm 【项目名称】
docker build -t 【项目名称】 -f deploy/Dockerfile .
docker run -d -p 【端口号】:【端口号】 --name 【项目名称】 --restart unless-stopped 【项目名称】
```

### 日常操作

```bash
# 查看状态
docker ps
docker logs 【项目名称】

# 停止
docker stop 【项目名称】

# 启动
docker start 【项目名称】

# 重启
docker restart 【项目名称】

# 彻底删除
docker stop 【项目名称】
docker rm 【项目名称】
docker rmi 【项目名称】
```

---

## 手动部署

```bash
cd ~/workspace
git clone 【GitHub地址】
cd 【项目文件夹名】
chmod +x deploy/deploy.sh
./deploy/deploy.sh
```

---

## 安全组配置

在阿里云控制台开放端口 【端口号】：
- 协议：TCP
- 端口范围：【端口号】
- 授权对象：0.0.0.0/0
```

---

# ✅ AI 自检清单

生成文件前，检查以下内容：

**文件完整性：**
- [ ] 已生成 Dockerfile
- [ ] 已生成 docker-compose.yml
- [ ] 已生成 deploy.sh
- [ ] 已生成 nginx.conf
- [ ] 已生成 【项目名称】.service
- [ ] 已生成 README.md

**占位符检查：**
- [ ] 所有 `【xxx】` 已替换为实际值
- [ ] 输出文件中不存在 `【` 或 `】` 字符

**一致性检查：**
- [ ] 端口号在所有文件中一致
- [ ] 项目名称在所有文件中一致
- [ ] 入口文件名在所有文件中一致

---

# 附录：常见问题

## Docker 构建超时
国内服务器必须使用阿里云镜像，Dockerfile 中已配置。

## 端口无法访问
1. 检查阿里云安全组是否开放端口
2. 检查应用是否监听 0.0.0.0

## 容器名冲突
```bash
docker ps -a
docker rm -f 【项目名称】
```

## 清理 Docker 资源
```bash
docker system prune -a
```
